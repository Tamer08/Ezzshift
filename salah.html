<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Tahoma,Arial;background:#fff;color:#000}
.container{min-height:100vh;padding:15px;display:flex;justify-content:center;align-items:center}
.card{
 width:100%;max-width:420px;background:#E6E6E6;border-radius:20px;
 padding:20px;border:1px solid #D0D0D0;box-shadow:0 8px 20px rgba(0,0,0,.12)
}
h1{text-align:center;font-size:24px;margin:0 0 10px;color:#D48B00;font-weight:800}
.countdown{text-align:center;font-size:17px;margin-bottom:15px;color:#FEA500;font-weight:bold}
.prayer{
 display:flex;justify-content:space-between;align-items:center;
 padding:14px;margin-bottom:10px;background:#fff;border-radius:14px;
 font-size:16px;border:1px solid #d6d6d6
}
.prayer span:last-child{font-weight:bold}
.prayer.active{background:#FEA500;color:#fff;border-color:#FEA500}
.footer{text-align:center;margin-top:12px;font-size:14px;color:#666}
</style>
</head>

<body>

<div class="container">
  <div class="card">
    <h1>ðŸ•Œ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©</h1>
    <div class="countdown" id="countdown">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    <div id="prayers"></div>
    <div class="footer" id="location"></div>
  </div>
</div>

<script>
/* ================== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ================== */
const city="Cairo";
const country="Egypt";
const STORAGE_KEY="prayer_times_cairo";

/* ================== ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙ„ÙˆØ§Øª ================== */
const prayerOrder=[
 {key:"Fajr",name:"Ø§Ù„ÙØ¬Ø±"},
 {key:"Sunrise",name:"Ø§Ù„Ø´Ø±ÙˆÙ‚"},
 {key:"Dhuhr",name:"Ø§Ù„Ø¸Ù‡Ø±"},
 {key:"Asr",name:"Ø§Ù„Ø¹ØµØ±"},
 {key:"Maghrib",name:"Ø§Ù„Ù…ØºØ±Ø¨"},
 {key:"Isha",name:"Ø§Ù„Ø¹Ø´Ø§Ø¡"}
];

let prayerTimes={};

/* ================== Ø£Ø¯ÙˆØ§Øª ================== */
function cleanTime(t){
 if(!t) return null;
 return t.split(" ")[0]; // Ø¥Ø²Ø§Ù„Ø© (EET)
}

function to12(t){
 t=cleanTime(t);
 if(!t) return "--:--";
 let[h,m]=t.split(":").map(Number);
 const p=h>=12?"Ù…":"Øµ";
 h=h%12||12;
 return `${h}:${m.toString().padStart(2,"0")} ${p}`;
}

/* ================== Ø§Ù„Ø¹Ø±Ø¶ ================== */
function renderPrayers(active=null){
 const box=document.getElementById("prayers");
 box.innerHTML="";
 prayerOrder.forEach(p=>{
  const div=document.createElement("div");
  div.className="prayer"+(p.key===active?" active":"");
  div.innerHTML=`
   <span>${p.name}</span>
   <span>${to12(prayerTimes[p.key])}</span>
  `;
  box.appendChild(div);
 });
}

function updateCountdown(){
 const now=new Date();
 let nextPrayer,nextTime;

 for(let p of prayerOrder){
  const tStr=cleanTime(prayerTimes[p.key]);
  if(!tStr) continue;
  const [h,m]=tStr.split(":").map(Number);
  const t=new Date();
  t.setHours(h,m,0,0);
  if(t>now){nextPrayer=p;nextTime=t;break;}
 }

 if(!nextPrayer){
  nextPrayer=prayerOrder[0];
  const [h,m]=cleanTime(prayerTimes[nextPrayer.key]).split(":").map(Number);
  nextTime=new Date();
  nextTime.setDate(nextTime.getDate()+1);
  nextTime.setHours(h,m,0,0);
 }

 const diff=nextTime-now;
 const h=Math.floor(diff/3600000);
 const m=Math.floor(diff%3600000/60000);
 const s=Math.floor(diff%60000/1000);

 document.getElementById("countdown").innerText=
  `Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${nextPrayer.name} Ø¨Ø¹Ø¯ ${h}Ø³ ${m}Ø¯ ${s}Ø«`;

 renderPrayers(nextPrayer.key);
}

/* ================== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† / Ø£ÙˆÙÙ„Ø§ÙŠÙ†) ================== */
function load(){
 const cached=localStorage.getItem(STORAGE_KEY);
 if(cached){
  prayerTimes=JSON.parse(cached);
  document.getElementById("location").innerText=`ØªÙˆÙ‚ÙŠØª ${city} - ${country}`;
  renderPrayers();
  updateCountdown();
  setInterval(updateCountdown,1000);
  return;
 }

 fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=5`)
  .then(r=>r.json())
  .then(j=>{
   prayerTimes=j.data.timings;
   localStorage.setItem(STORAGE_KEY,JSON.stringify(prayerTimes));
   document.getElementById("location").innerText=`ØªÙˆÙ‚ÙŠØª ${city} - ${country}`;
   renderPrayers();
   updateCountdown();
   setInterval(updateCountdown,1000);
  })
  .catch(()=>{
   document.getElementById("countdown").innerText="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ù†ØªØ±Ù†Øª ÙˆÙ„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©";
  });
}

load();

/* ================== Service Worker Ø¯Ø§Ø®Ù„ÙŠ ================== */
if("serviceWorker"in navigator){
 const swCode=`
  self.addEventListener("fetch",e=>{
   e.respondWith(
    fetch(e.request).then(res=>{
     const r=res.clone();
     caches.open("prayer-cache").then(c=>c.put(e.request,r));
     return res;
    }).catch(()=>caches.match(e.request))
   );
  });
 `;
 const blob=new Blob([swCode],{type:"text/javascript"});
 navigator.serviceWorker.register(URL.createObjectURL(blob));
}
</script>

</body>
</html>
