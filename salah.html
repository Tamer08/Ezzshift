<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©</title>

<style>
/* ================== Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ================== */
*{box-sizing:border-box}
body{margin:0;font-family:Tahoma,Arial;background:#fff;color:#000}
.container{min-height:100vh;padding:15px;display:flex;justify-content:center;align-items:center}
.card{
 width:100%;max-width:420px;background:#E6E6E6;border-radius:20px;
 padding:20px;border:1px solid #D0D0D0;box-shadow:0 8px 20px rgba(0,0,0,.12)
}
h1{text-align:center;font-size:24px;margin:0 0 10px;color:#D48B00;font-weight:800}

/* ================== Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ ================== */
.countdown{
 display:flex; justify-content:center; align-items:center;
 gap:12px; margin-bottom:15px; font-family:'Tahoma',Arial
}
.next-prayer{ font-size:16px; font-weight:bold; color:#D48B00 }
.led{
 display:flex; gap:8px; background:#f7f7f7; padding:6px 12px;
 border-radius:10px; border:1px solid #d6d6d6;
 box-shadow:inset 0 0 6px rgba(0,0,0,.08)
}
.unit{ display:flex; align-items:baseline; gap:3px }
.unit span{ font-size:17px; font-weight:bold; color:#333; min-width:22px; text-align:center }
.unit small{ font-size:11px; color:#888 }
.sep{ font-weight:bold; color:#aaa; padding:0 2px }

/* ================== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙ„ÙˆØ§Øª ================== */
.prayer{
 display:flex;justify-content:space-between;align-items:center;
 padding:14px;margin-bottom:10px;background:#fff;border-radius:14px;
 font-size:16px;border:1px solid #d6d6d6
}
.prayer span:last-child{font-weight:bold}
.prayer.active{background:#FEA500;color:#fff;border-color:#FEA500}

.footer{text-align:center;margin-top:12px;font-size:14px;color:#666}

/* ================== Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„ ================== */
@media screen and (max-width: 768px) {
    h1 { white-space: nowrap; font-size: 7vw !important; }
    .next-prayer { white-space: nowrap; font-size: 4.5vw !important; }
    .unit span { font-size: 5.5vw !important; }
    .unit small { font-size: 3vw !important; }
    .prayer span { white-space: nowrap; font-size: 4.5vw !important; }
    .footer { white-space: nowrap; font-size: 3.5vw !important; }
}
</style>
</head>

<body>

<div class="container">
  <div class="card">
    <h1>ğŸ•Œ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©</h1>
    
    <!-- Ø§Ù„Ø¹Ø¯Ø§Ø¯ -->
    <div class="countdown" id="countdown">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙ„ÙˆØ§Øª -->
    <div id="prayers"></div>
    
    <!-- Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® -->
    <div class="footer" id="location"></div>
  </div>
</div>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
const city = "Cairo";
const country = "Egypt";

// Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† (ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø¶Ù…Ø§Ù† Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
const STORAGE_KEY = "prayer_times_final_v3";

const prayerOrder = [
 {key:"Fajr",name:"Ø§Ù„ÙØ¬Ø±"},
 {key:"Sunrise",name:"Ø§Ù„Ø´Ø±ÙˆÙ‚"},
 {key:"Dhuhr",name:"Ø§Ù„Ø¸Ù‡Ø±"},
 {key:"Asr",name:"Ø§Ù„Ø¹ØµØ±"},
 {key:"Maghrib",name:"Ø§Ù„Ù…ØºØ±Ø¨"},
 {key:"Isha",name:"Ø§Ù„Ø¹Ø´Ø§Ø¡"}
];

let prayerTimes = {};

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ/Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ (ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¶)
function getArabicDate(){
 const days=["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
 const months=["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"];
 const now=new Date();
 return `${days[now.getDay()]} ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
}

// ØªÙ†Ø¸ÙŠÙ ØµÙŠØºØ© Ø§Ù„ÙˆÙ‚Øª
function cleanTime(t){
 if(!t) return null;
 return t.split(" ")[0]; // ÙŠØ²ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© (EEST) Ø¥Ù† ÙˆØ¬Ø¯Øª
}

// ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ù„Ù€ 12 Ø³Ø§Ø¹Ø©
function to12(t){
 t=cleanTime(t);
 if(!t) return "--:--";
 let[h,m]=t.split(":").map(Number);
 const p=h>=12?"Ù…":"Øµ";
 h=h%12||12;
 return `${h}:${m.toString().padStart(2,"0")} ${p}`;
}

// Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„ÙˆØ§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø©
function renderPrayers(active=null){
 const box=document.getElementById("prayers");
 box.innerHTML="";
 prayerOrder.forEach(p=>{
  const div=document.createElement("div");
  div.className="prayer"+(p.key===active?" active":"");
  div.innerHTML=`
   <span>${p.name}</span>
   <span>${to12(prayerTimes[p.key])}</span>
  `;
  box.appendChild(div);
 });
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
function updateCountdown(){
 if(!Object.keys(prayerTimes).length) return;

 const now=new Date();
 let nextPrayer,nextTime;

 for(let p of prayerOrder){
  const tStr=cleanTime(prayerTimes[p.key]);
  if(!tStr) continue;
  const [h,m]=tStr.split(":").map(Number);
  const t=new Date();
  t.setHours(h,m,0,0);
  if(t>now){nextPrayer=p;nextTime=t;break;}
 }

 if(!nextPrayer){
  nextPrayer=prayerOrder[0];
  const [h,m]=cleanTime(prayerTimes[nextPrayer.key]).split(":").map(Number);
  nextTime=new Date();
  nextTime.setDate(nextTime.getDate()+1);
  nextTime.setHours(h,m,0,0);
 }

 const diff=nextTime-now;
 const h=String(Math.floor(diff/3600000)).padStart(2,"0");
 const m=String(Math.floor(diff%3600000/60000)).padStart(2,"0");
 const s=String(Math.floor(diff%60000/1000)).padStart(2,"0");

 document.getElementById("countdown").innerHTML=`
  <div class="next-prayer">${nextPrayer.name}</div>
  <div class="led">
    <div class="unit"><span>${h}</span><small>Ø³</small></div>
    <div class="sep">:</div>
    <div class="unit"><span>${m}</span><small>Ø¯</small></div>
    <div class="sep">:</div>
    <div class="unit"><span>${s}</span><small>Ø«</small></div>
  </div>
 `;

 renderPrayers(nextPrayer.key);
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„Ù…Ø¤Ù‚Øª
function initInterface() {
    document.getElementById("location").innerHTML = `ØªÙˆÙ‚ÙŠØª ${city} - ${country}<br>${getArabicDate()}`;
    renderPrayers();
    updateCountdown();
    // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ø¤Ù‚Øª
    if (!window.timerInterval) {
        window.timerInterval = setInterval(updateCountdown, 1000);
    }
}

// ================== Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØªØ­Ù…ÙŠÙ„ (Ù…Ø¹Ø¯Ù„Ø©) ==================
function load(){
 const now = new Date();
 // Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒÙ†Øµ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (Ù…Ø«Ø§Ù„: Mon Jan 05 2026)
 const todayStr = now.toDateString(); 
 
 const cached = localStorage.getItem(STORAGE_KEY);

 if(cached){
  try {
      const parsedData = JSON.parse(cached);
      // 1. Ø§Ù„ØªØ­Ù‚Ù‚: Ù‡Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­ÙÙˆØ¸ ÙŠØ·Ø§Ø¨Ù‚ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…ØŸ
      if (parsedData.date === todayStr) {
          // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙŠØ«Ø© -> Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ ÙÙˆØ±Ø§Ù‹
          prayerTimes = parsedData.timings;
          initInterface();
          return;
      }
      // Ø¥Ø°Ø§ ÙˆØµÙ„Ù†Ø§ Ù‡Ù†Ø§ØŒ ÙŠØ¹Ù†ÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù‚Ø¯ÙŠÙ… -> Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
  } catch (e) {
      console.error("Cache error", e);
  }
 }

 // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª (Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© ÙˆÙ‚Øª Ù„Ù„Ø±Ø§Ø¨Ø· Ù„Ù…Ù†Ø¹ Ø§Ù„ÙƒØ§Ø´)
 // &t=${Date.now()} -> Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ØªØ¬Ø¨Ø± Ø§Ù„ÙˆÙŠØ¨ ÙÙŠÙˆ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
 fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=5&t=${Date.now()}`)
  .then(r=>r.json())
  .then(j=>{
   prayerTimes = j.data.timings;
   
   // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
   const dataToSave = {
       date: todayStr,
       timings: prayerTimes
   };
   
   localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
   initInterface();
  })
  .catch(err => {
      // 3. ÙÙŠ Ø­Ø§Ù„ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
      if(cached) {
          // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙƒØ­Ù„ Ù…Ø¤Ù‚Øª
          const parsedData = JSON.parse(cached);
          prayerTimes = parsedData.timings;
          initInterface();
          // Ù†Ø¶ÙŠÙ ØªÙ†Ø¨ÙŠÙ‡ ØµØºÙŠØ±
          const footer = document.getElementById("location");
          footer.innerHTML += `<br><span style="color:#e74c3c;font-size:12px;font-weight:bold">(Ø£ÙˆÙÙ„Ø§ÙŠÙ† - Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©)</span>`;
      } else {
          document.getElementById("countdown").innerHTML = "<span style='color:red'>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</span>";
      }
  });
}

// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
load();

// Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© (ÙÙŠ Ø­Ø§Ù„ ØªØºÙŠØ± Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ÙØªÙˆØ­)
setInterval(() => {
    const now = new Date();
    const stored = localStorage.getItem(STORAGE_KEY);
    if(stored) {
        const parsed = JSON.parse(stored);
        if(parsed.date !== now.toDateString()) {
            location.reload(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ Ø¯Ø®Ù„ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯
        }
    }
}, 60000);

</script>

</body>
</html>